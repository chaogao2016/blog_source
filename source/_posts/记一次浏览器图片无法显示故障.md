---
title: 记一次浏览器图片无法显示故障
date: 2020-05-10 19:59:41
tags:
---
#### 这是上周五调试开发环境的时候遇到的问题，解决方式还挺曲折的，记在这里

## 现象
&emsp;&emsp;今天接第一个需求，内容挺简单的，不细说了。但是在本地环境运行项目的时候发现一个问题，某个页面中的图片只有部分能访问，经过观察，首先发现了一个特征。

- &nbsp;&nbsp;**能够正常访问的图片和无法正常访问的图片域名不一致。**

&emsp;&emsp;这给了我一些思路，不同的域名指向不同的目录，也许是图片需要单独拉取而不是存在代码仓库里。

&emsp;&emsp;于是我顺着这个思路去找，很遗憾，这两个域名虽然指向的目录不一致，但是两个目录是有包含关系的，域名不同的情况下，合法的相对路径依然会指向同样的文件。起码在测试环境上，这种配置是可以正常运行的。这个思路pass。

&emsp;&emsp;再提出一个想法：

- &nbsp;&nbsp;**我们知道一般的web应用都会做url美化，符合过滤条件的请求，都会最终解析到index.php文件去处理，为了达到这一目的，web程序会根据配置文件对符合特定规则的http请求进行url重写(rewrite)，有没有可能是这样，因为我的web程序是本地搭建的，rewrite规则很多都是默认的，很多配置都和测试环境不一样，也许就是因为rewrite规则写错了，图片请求没有被正确重写。**

&emsp;&emsp;这个想法让我直觉上感到异常靠谱，我开始顺着这条思路去找答案。

&emsp;&emsp;重写规则既可以写在web程序的配置文件里，也可以写在应用程序根目录的.htaccess文件里。我去这两个地方都找了。我用的是apache的httpd，遗憾的是我用了大量的时间对比规则的正确性，因为我对规则配置语格式非常不熟悉。得出的结论是，rewrite规则没有问题。

&emsp;&emsp;我的直觉太弱鸡了。

&emsp;&emsp;最后我依然解决了这个问题，其实有非常明显的表现。图片无法访问的时候是有报错的，这个时候报的是nginx的404错误。可是，我的web程序明明是apache的，为什么会这样呢？

&emsp;&emsp;因为这是个虚拟桌面开发环境，是克隆的别人已有的开发环境。在他的后台已经有运行了一个nginx服务，这个服务注册了一个我代码中用到的域名，导致了这样的结果。

### 解决方案
&emsp;&emsp;解决方法是，我给两个域名全换成了localhost，用不同端口来区别，改了配置文件以后，ok了！

### 总结
&emsp;&emsp;解决这个问题的途中，发现自己有两个明显的坏习惯。

1. 遇事乱猜。正确的方法应该是先收集所有有关信息，再统一列出猜想，一个个论证。我这种凭直接乱猜一气的方式效率非常低下！
1. 对自己的工具不熟悉。php也搞了几年了，rewrite配置规则还要现百度。我对整个php后端开发的工具链还只是能简单使用，甚至还达不到熟练使用的标准，更不要说精通了，这个非常值得警惕！